# Инструкции по установке Excel MCP Server

## Предварительные требования

### Системные требования
- **ОС**: Windows 10/11 (64-bit)
- **Python**: 3.10 или новее
- **Microsoft Excel**: 2016 или новее
- **RAM**: Минимум 4 GB, рекомендуется 8 GB
- **Свободное место**: Минимум 1 GB

### Установка Python
1. Скачайте Python 3.10+ с [python.org](https://www.python.org/downloads/)
2. При установке обязательно отметьте "Add Python to PATH"
3. Проверьте установку: `python --version`

### Установка Microsoft Excel
1. Установите Microsoft Excel 2016 или новее
2. Убедитесь, что Excel работает корректно
3. Запустите Excel хотя бы один раз для регистрации COM объектов

## Установка Excel MCP Server

### Шаг 1: Клонирование репозитория
```bash
git clone <repository-url>
cd excel-mcp-server
```

### Шаг 2: Создание виртуального окружения
```bash
# Создание виртуального окружения
python -m venv venv

# Активация виртуального окружения
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate
```

### Шаг 3: Установка зависимостей
```bash
# Обновление pip
python -m pip install --upgrade pip

# Установка зависимостей
pip install -r requirements.txt
```

### Шаг 4: Установка сервера
```bash
# Установка в режиме разработки
pip install -e .
```

### Шаг 5: Проверка установки
```bash
# Проверка доступности команды
excel-mcp-server --help

# Или запуск модуля
python -m src.server
```

## Настройка для Cursor IDE

### Вариант 1: Через .cursorrules (рекомендуется)
1. Убедитесь, что файл `.cursorrules` находится в корне проекта
2. Перезапустите Cursor IDE
3. Сервер автоматически подключится при открытии проекта

### Вариант 2: Через settings.json
1. Откройте настройки Cursor (Ctrl+,)
2. Найдите раздел "MCP Servers"
3. Добавьте конфигурацию:
```json
{
  "mcp.servers": {
    "excel": {
      "command": "excel-mcp-server",
      "args": []
    }
  }
}
```

### Вариант 3: Глобальная настройка
1. Создайте файл `%APPDATA%\Cursor\User\settings.json`
2. Добавьте конфигурацию MCP сервера
3. Перезапустите Cursor

## Настройка безопасности Excel

### Включение доступа к VBA проекту
1. Откройте Excel
2. Перейдите в **Файл** → **Параметры** → **Центр управления безопасностью**
3. Нажмите **Параметры центра управления безопасностью**
4. Выберите **Доступ к VBA проекту**
5. Отметьте **Доверять доступ к модели объектов проектов Microsoft Office**

### Включение макросов
1. В том же разделе выберите **Параметры макросов**
2. Выберите **Включить все макросы** или **Отключить все макросы с уведомлением**

## Проверка работоспособности

### Тест 1: Проверка подключения к Excel
```bash
python -c "
from src.excel_controller import ExcelController
with ExcelController() as excel:
    info = excel.get_excel_info()
    print('Excel подключен:', info)
"
```

### Тест 2: Запуск примеров
```bash
python examples/basic_usage.py
```

### Тест 3: Запуск тестов
```bash
python -m pytest tests/
```

## Устранение неполадок

### Проблема: "Excel не найден"
**Решение:**
1. Убедитесь, что Excel установлен и зарегистрирован
2. Запустите Excel вручную хотя бы один раз
3. Проверьте права доступа к COM объектам

### Проблема: "Доступ к VBA проекту запрещен"
**Решение:**
1. Включите доверие к VBA проекту в настройках Excel
2. Запустите Cursor от имени администратора
3. Проверьте настройки безопасности Windows

### Проблема: "Не удается подключиться к MCP серверу"
**Решение:**
1. Проверьте конфигурацию в `.cursorrules`
2. Убедитесь, что сервер запускается: `python -m src.server`
3. Проверьте логи в файле `excel_mcp.log`

### Проблема: "Ошибка COM"
**Решение:**
1. Перезапустите Excel
2. Запустите от имени администратора
3. Проверьте версию pywin32: `pip install --upgrade pywin32`

## Логирование

### Просмотр логов
```bash
# Логи в реальном времени
tail -f excel_mcp.log

# Последние 100 строк
tail -n 100 excel_mcp.log
```

### Настройка уровня логирования
Отредактируйте файл `config/server_config.json`:
```json
{
  "logging": {
    "level": "DEBUG",  // INFO, DEBUG, WARNING, ERROR
    "file": "excel_mcp.log"
  }
}
```

## Производительность

### Оптимизация кэша
```json
{
  "cache": {
    "enabled": true,
    "workbooks_ttl": 600,    // 10 минут
    "worksheets_ttl": 300,   // 5 минут
    "range_ttl": 60,         // 1 минута
    "max_size": 100
  }
}
```

### Batch операции
Для множественных операций используйте batch режим:
```python
# Вместо множественных вызовов
for i in range(100):
    write_cell(f"A{i}", value)

# Используйте batch операцию
write_range("A1:A100", values)
```

## Обновление

### Обновление сервера
```bash
# Остановите сервер
# Обновите код
git pull origin main

# Переустановите зависимости
pip install -r requirements.txt --upgrade

# Перезапустите сервер
```

### Обновление Excel
1. Обновите Microsoft Excel до последней версии
2. Перезапустите систему
3. Проверьте работоспособность сервера

## Поддержка

### Получение помощи
- **Документация**: README.md
- **Примеры**: папка `examples/`
- **Тесты**: папка `tests/`
- **Логи**: файл `excel_mcp.log`

### Отчет об ошибках
При возникновении проблем:
1. Проверьте логи: `excel_mcp.log`
2. Соберите информацию о системе
3. Создайте issue в репозитории

### Контакты
- **GitHub**: [Ссылка на репозиторий]
- **Email**: [email]
- **Документация**: [Ссылка на документацию] 