# Документация API PC Control MCP Server

## Обзор

PC Control MCP Server предоставляет полный набор инструментов для управления системой через Model Context Protocol (MCP). Все инструменты следуют единообразным паттернам для ввода/вывода и обработки ошибок.

## Общий формат ответа

Все инструменты возвращают JSON ответы со следующей структурой:

```json
{
  "success": true,
  "data": {
    // Данные специфичные для инструмента
  },
  "error": null,
  "timestamp": "2024-01-01T00:00:00Z"
}
```

## Системные инструменты

### get_system_info

Получение полной информации о системе.

**Параметры:**
- `info_type` (строка, опционально): Тип информации для получения
  - `all`: Вся системная информация (по умолчанию)
  - `basic`: Только базовая информация
  - `cpu`: Информация о процессоре
  - `memory`: Информация о памяти
  - `disk`: Информация о дисках
  - `network`: Информация о сети

**Ответ:**
```json
{
  "system": {
    "hostname": "pc-name",
    "platform": "Windows",
    "version": "10.0.19044",
    "architecture": "x86_64"
  },
  "cpu": {
    "model": "Intel Core i7-9700K",
    "cores": 8,
    "threads": 8,
    "frequency": 3600
  },
  "memory": {
    "total": 17179869184,
    "available": 8589934592,
    "percent": 50.0
  }
}
```

### execute_command

Выполнение системной команды с валидацией безопасности.

**Параметры:**
- `command` (строка, обязательно): Команда для выполнения
- `shell` (булево, по умолчанию: true): Использовать shell
- `timeout` (целое, опционально): Таймаут команды в секундах
- `working_directory` (строка, опционально): Рабочая директория

**Ответ:**
```json
{
  "command": "echo привет",
  "exit_code": 0,
  "stdout": "привет\n",
  "stderr": "",
  "duration": 0.05
}
```

## Инструменты процессов

### list_processes

Список запущенных процессов с опциональными фильтрами.

**Параметры:**
- `filters` (объект, опционально):
  - `name` (строка): Фильтр по имени процесса
  - `user` (строка): Фильтр по пользователю
  - `status` (строка): Фильтр по статусу
  - `min_cpu` (число): Минимальное использование CPU
  - `min_memory` (число): Минимальное использование памяти
  - `sort_by` (строка): Поле для сортировки
  - `limit` (целое): Максимум результатов

**Ответ:**
```json
{
  "processes": [
    {
      "pid": 1234,
      "name": "chrome.exe",
      "username": "user",
      "cpu_percent": 2.5,
      "memory_percent": 3.2,
      "status": "running",
      "create_time": 1704067200
    }
  ],
  "total": 150,
  "filtered": 10
}
```

### get_process_info

Получение детальной информации о процессе.

**Параметры:**
- `pid` (целое, обязательно): ID процесса

**Ответ:**
```json
{
  "pid": 1234,
  "name": "chrome.exe",
  "exe": "C:\\Program Files\\Google\\Chrome\\chrome.exe",
  "cmdline": ["chrome.exe", "--flag"],
  "create_time": 1704067200,
  "cpu": {
    "percent": 2.5,
    "times": {
      "user": 100.5,
      "system": 50.2
    }
  },
  "memory": {
    "rss": 104857600,
    "vms": 209715200,
    "percent": 3.2
  }
}
```

### kill_process

Завершение процесса.

**Параметры:**
- `pid` (целое, обязательно): ID процесса
- `force` (булево, по умолчанию: false): Принудительное завершение
- `timeout` (целое, по умолчанию: 30): Таймаут в секундах

**Ответ:**
```json
{
  "pid": 1234,
  "name": "app.exe",
  "action": "terminated",
  "success": true
}
```

## Файловые инструменты

### read_file

Чтение содержимого файла с ограничением размера.

**Параметры:**
- `path` (строка, обязательно): Путь к файлу
- `encoding` (строка, по умолчанию: "utf-8"): Кодировка файла
- `max_size` (целое, опционально): Максимальный размер файла

**Ответ:**
```json
{
  "path": "/путь/к/файлу.txt",
  "content": "Содержимое файла...",
  "size": 1024,
  "encoding": "utf-8"
}
```

### write_file

Запись содержимого в файл.

**Параметры:**
- `path` (строка, обязательно): Путь к файлу
- `content` (строка, обязательно): Содержимое для записи
- `encoding` (строка, по умолчанию: "utf-8"): Кодировка файла
- `create_dirs` (булево, по умолчанию: false): Создавать родительские директории

**Ответ:**
```json
{
  "path": "/путь/к/файлу.txt",
  "size": 1024,
  "action": "created",
  "success": true
}
```

### list_directory

Список содержимого директории.

**Параметры:**
- `path` (строка, обязательно): Путь к директории
- `recursive` (булево, по умолчанию: false): Рекурсивный список
- `include_hidden` (булево, по умолчанию: false): Включать скрытые файлы
- `pattern` (строка, опционально): Паттерн фильтра

**Ответ:**
```json
{
  "path": "/директория",
  "entries": [
    {
      "name": "файл.txt",
      "type": "file",
      "size": 1024,
      "modified": "2024-01-01T00:00:00Z",
      "permissions": "rw-r--r--"
    }
  ],
  "total_size": 10240,
  "file_count": 5,
  "dir_count": 2
}
```

## Сетевые инструменты

### get_network_interfaces

Получение всех сетевых интерфейсов.

**Параметры:**
- `include_stats` (булево, по умолчанию: true): Включать статистику интерфейсов

**Ответ:**
```json
{
  "interfaces": [
    {
      "name": "eth0",
      "is_up": true,
      "speed": 1000,
      "mtu": 1500,
      "addresses": [
        {
          "family": "AF_INET",
          "address": "192.168.1.100",
          "netmask": "255.255.255.0"
        }
      ],
      "statistics": {
        "bytes_sent": 1048576,
        "bytes_recv": 2097152,
        "packets_sent": 1000,
        "packets_recv": 2000
      }
    }
  ]
}
```

### ping_host

Пинг хоста для проверки доступности.

**Параметры:**
- `host` (строка, обязательно): Хост для пинга
- `count` (целое, по умолчанию: 4): Количество пингов
- `timeout` (целое, по умолчанию: 5): Таймаут для каждого пинга
- `packet_size` (целое, по умолчанию: 32): Размер пакета

**Ответ:**
```json
{
  "host": "google.com",
  "ip_address": "142.250.185.78",
  "success": true,
  "statistics": {
    "packets_sent": 4,
    "packets_received": 4,
    "packet_loss": 0.0,
    "min_ms": 10.5,
    "avg_ms": 15.2,
    "max_ms": 20.1
  }
}
```

### port_scan

Сканирование портов на хосте.

**Параметры:**
- `host` (строка, обязательно): Хост для сканирования
- `ports` (массив, обязательно): Список портов для сканирования
- `timeout` (число, по умолчанию: 1.0): Таймаут на порт

**Ответ:**
```json
{
  "host": "localhost",
  "ip_address": "127.0.0.1",
  "ports": {
    "80": {
      "state": "open",
      "service": "HTTP"
    },
    "443": {
      "state": "closed"
    }
  },
  "open_ports": [80],
  "closed_ports": [443]
}
```

## Инструменты служб

### list_services

Список системных служб.

**Параметры:**
- `include_drivers` (булево, по умолчанию: false): Включать службы драйверов (Windows)

**Ответ:**
```json
{
  "services": [
    {
      "name": "nginx",
      "display_name": "Веб-сервер Nginx",
      "status": "running",
      "startup_type": "automatic",
      "pid": 1234
    }
  ]
}
```

### control_service

Управление системной службой.

**Параметры:**
- `service_name` (строка, обязательно): Имя службы
- `action` (строка, обязательно): Действие для выполнения
  - `start`: Запустить службу
  - `stop`: Остановить службу
  - `restart`: Перезапустить службу

**Ответ:**
```json
{
  "service": "nginx",
  "action": "restart",
  "success": true,
  "status": "running"
}
```

## Инструменты реестра (только Windows)

### read_registry

Чтение значения реестра.

**Параметры:**
- `key_path` (строка, обязательно): Путь ключа реестра
- `value_name` (строка, обязательно): Имя значения

**Ответ:**
```json
{
  "key": "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion",
  "name": "ProgramFilesDir",
  "value": "C:\\Program Files",
  "type": "REG_SZ"
}
```

### write_registry

Запись значения реестра.

**Параметры:**
- `key_path` (строка, обязательно): Путь ключа реестра
- `value_name` (строка, обязательно): Имя значения
- `value` (любой, обязательно): Значение для записи
- `value_type` (строка, по умолчанию: "REG_SZ"): Тип значения реестра

**Ответ:**
```json
{
  "key": "HKCU\\Software\\MyApp",
  "name": "Setting",
  "type": "REG_DWORD",
  "action": "write",
  "success": true
}
```

## Инструменты GUI автоматизации

### move_mouse

Перемещение мыши в указанную позицию.

**Параметры:**
- `x` (целое, обязательно): Координата X
- `y` (целое, обязательно): Координата Y
- `duration` (число, по умолчанию: 0): Длительность движения
- `relative` (булево, по умолчанию: false): Относительное движение

**Ответ:**
```json
{
  "action": "move_mouse",
  "target": {"x": 500, "y": 300},
  "final": {"x": 500, "y": 300},
  "success": true
}
```

### click_mouse

Клик мыши в позиции.

**Параметры:**
- `x` (целое, опционально): Координата X
- `y` (целое, опционально): Координата Y
- `button` (строка, по умолчанию: "left"): Кнопка мыши
- `clicks` (целое, по умолчанию: 1): Количество кликов

**Ответ:**
```json
{
  "action": "click_mouse",
  "position": {"x": 500, "y": 300},
  "button": "left",
  "success": true
}
```

### take_screenshot

Создание скриншота.

**Параметры:**
- `region` (массив, опционально): Область [x, y, ширина, высота]
- `save_path` (строка, опционально): Путь для сохранения файла

**Ответ:**
```json
{
  "action": "take_screenshot",
  "size": {"width": 1920, "height": 1080},
  "saved_to": "/путь/к/скриншоту.png",
  "success": true
}
```

## Обработка ошибок

Все инструменты используют единообразные ответы об ошибках:

```json
{
  "success": false,
  "error": {
    "type": "ValidationException",
    "message": "Недопустимый путь: содержит ссылку на родительскую директорию",
    "code": "INVALID_PATH"
  }
}
```

### Типы ошибок

- `SecurityException`: Нарушение политики безопасности
- `ValidationException`: Недопустимые входные параметры
- `SystemException`: Системная операция не удалась
- `NetworkException`: Сетевая операция не удалась
- `FileOperationException`: Файловая операция не удалась
- `ProcessException`: Операция с процессом не удалась
- `ServiceException`: Операция со службой не удалась
- `RegistryException`: Операция с реестром не удалась
- `AutomationException`: GUI автоматизация не удалась
- `RateLimitException`: Превышен лимит запросов
- `TimeoutException`: Таймаут операции

## Ограничение частоты запросов

API вызовы подлежат ограничению частоты:

- По умолчанию: 100 запросов в минуту
- Всплеск: 20 запросов
- Лимиты для пользователей настраиваются

Заголовки ограничения частоты:
- `X-RateLimit-Limit`: Лимит запросов
- `X-RateLimit-Remaining`: Оставшиеся запросы
- `X-RateLimit-Reset`: Время сброса