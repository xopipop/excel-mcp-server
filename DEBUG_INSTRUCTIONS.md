# Инструкции по отладке PC Control MCP Server

## Внесенные изменения

### 1. Исправление ошибки TaskGroup
- Добавлено детальное логирование в `main.py` для отслеживания процесса инициализации
- Создан `main_debug.py` с расширенной обработкой ошибок и диагностикой
- Добавлена проверка версии Python и доступности asyncio.TaskGroup

### 2. Исправление ошибки 'version' в системной информации
- В `demo.py` исправлено обращение к полю `platform_version` вместо `version`
- Добавлена безопасная проверка с fallback значениями

### 3. Добавлено отладочное логирование
- `main.py`: логирование инициализации сервера и stdio
- `src/tools/system_tools.py`: детальное логирование в `_get_basic_info()`
- `src/tools/process_tools.py`: логирование в `list_processes()`
- `src/tools/file_tools.py`: логирование в `write_file()`
- `src/core/config.py`: логирование создания и загрузки конфигурации

## Созданные тестовые скрипты

### 1. `test_debug.py`
Простой тест основных компонентов:
```bash
python test_debug.py
```

### 2. `check_mcp.py`
Проверка версии и состояния MCP:
```bash
python check_mcp.py
```

### 3. `test_server.py`
Детальная проверка stdio_server:
```bash
python test_server.py
```

### 4. `main_debug.py`
Версия сервера с расширенной отладкой:
```bash
python main_debug.py
```

## Порядок отладки

1. **Проверьте зависимости:**
   ```bash
   python check_mcp.py
   ```

2. **Запустите базовый тест:**
   ```bash
   python test_debug.py
   ```

3. **Проверьте демо (с отладкой):**
   ```bash
   python demo.py
   ```

4. **Если main.py не работает, используйте debug версию:**
   ```bash
   python main_debug.py
   ```

## Возможные проблемы и решения

### 1. "unhandled errors in a TaskGroup"
**Причина:** MCP библиотека использует asyncio.TaskGroup, который доступен только в Python 3.11+

**Решение:** 
- Убедитесь, что используется Python 3.11 или выше
- Проверьте версию: `python --version`
- Если версия старше, обновите Python или используйте альтернативную реализацию

### 2. Ошибка с stdio_server
**Причина:** stdio_server ожидает правильную настройку stdin/stdout

**Решение:**
- Запускайте из обычного терминала (не из IDE)
- На Windows используйте Git Bash или обычный cmd/PowerShell
- Убедитесь, что нет перенаправления потоков

### 3. Проблемы с импортом модулей
**Причина:** Неправильные пути или отсутствующие зависимости

**Решение:**
- Запускайте из корневой директории проекта
- Проверьте установку всех зависимостей: `pip install -r requirements.txt`

## Анализ вывода отладки

При запуске с отладкой обратите внимание на:

1. **DEBUG: ConfigManager** - проверьте, что конфигурация загружается правильно
2. **DEBUG: PCControlServer.__init__** - все компоненты должны создаваться без ошибок
3. **DEBUG: stdio_server** - здесь обычно возникает ошибка TaskGroup

Если видите ошибку на этапе stdio_server, проверьте:
- Версию Python (должна быть 3.11+)
- Версию MCP библиотеки
- Окружение запуска (терминал, переменные среды)

## Дополнительная диагностика

Для более глубокой диагностики можно:

1. Включить полное логирование Python:
   ```bash
   PYTHONVERBOSE=1 python main.py
   ```

2. Проверить системные вызовы (Linux/Mac):
   ```bash
   strace -e trace=file python main.py 2>&1 | grep -E "(open|stat)"
   ```

3. Проверить переменные окружения:
   ```bash
   env | grep -E "(PYTHON|PATH|HOME)"
   ```